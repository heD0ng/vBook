<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack | Hevin</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="我是这个博客模板的描述">
    <meta name="keywords" content="前端、Vue、Js、Css">
    
    <link rel="preload" href="/vBook/assets/css/0.styles.28fda393.css" as="style"><link rel="preload" href="/vBook/assets/js/app.005be619.js" as="script"><link rel="preload" href="/vBook/assets/js/2.60c04350.js" as="script"><link rel="preload" href="/vBook/assets/js/30.671a188d.js" as="script"><link rel="prefetch" href="/vBook/assets/js/10.08ae6bfe.js"><link rel="prefetch" href="/vBook/assets/js/11.589fd8d4.js"><link rel="prefetch" href="/vBook/assets/js/12.399c8fad.js"><link rel="prefetch" href="/vBook/assets/js/13.fe3e0b10.js"><link rel="prefetch" href="/vBook/assets/js/14.8d78ac7a.js"><link rel="prefetch" href="/vBook/assets/js/15.c12b314c.js"><link rel="prefetch" href="/vBook/assets/js/16.60de5270.js"><link rel="prefetch" href="/vBook/assets/js/17.8bf31597.js"><link rel="prefetch" href="/vBook/assets/js/18.3bb24d08.js"><link rel="prefetch" href="/vBook/assets/js/19.ed45222b.js"><link rel="prefetch" href="/vBook/assets/js/20.b569d5a0.js"><link rel="prefetch" href="/vBook/assets/js/21.6224960a.js"><link rel="prefetch" href="/vBook/assets/js/22.4c00de9c.js"><link rel="prefetch" href="/vBook/assets/js/23.c29555ac.js"><link rel="prefetch" href="/vBook/assets/js/24.dbd02386.js"><link rel="prefetch" href="/vBook/assets/js/25.a9d0322f.js"><link rel="prefetch" href="/vBook/assets/js/26.3141d0a1.js"><link rel="prefetch" href="/vBook/assets/js/27.fc838733.js"><link rel="prefetch" href="/vBook/assets/js/28.b9a03b20.js"><link rel="prefetch" href="/vBook/assets/js/29.2bc2e667.js"><link rel="prefetch" href="/vBook/assets/js/3.8ddea703.js"><link rel="prefetch" href="/vBook/assets/js/31.a0cc0494.js"><link rel="prefetch" href="/vBook/assets/js/4.14c7a5e4.js"><link rel="prefetch" href="/vBook/assets/js/5.d32810d9.js"><link rel="prefetch" href="/vBook/assets/js/6.c0dc5b16.js"><link rel="prefetch" href="/vBook/assets/js/7.ea2875e7.js"><link rel="prefetch" href="/vBook/assets/js/8.ea94888f.js"><link rel="prefetch" href="/vBook/assets/js/9.9f84188c.js">
    <link rel="stylesheet" href="/vBook/assets/css/0.styles.28fda393.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vBook/" class="home-link router-link-active"><!----> <span class="site-name">Hevin</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vBook/" class="nav-link">首页</a></div><div class="nav-item"><a href="/vBook/pages/a94f09/" class="nav-link">博客</a></div><div class="nav-item"><a href="/vBook/pages/264e1a/" class="nav-link">专题内容</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/vBook/" class="nav-link">首页</a></div><div class="nav-item"><a href="/vBook/pages/a94f09/" class="nav-link">博客</a></div><div class="nav-item"><a href="/vBook/pages/264e1a/" class="nav-link">专题内容</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>html</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vBook/pages/a94f09/" class="sidebar-link">HTML5新特性</a></li><li><a href="/vBook/pages/db81df/" class="sidebar-link">Cookie与Session</a></li><li><a href="/vBook/pages/01f82a/" class="sidebar-link">LocalStorage与SessionStorage</a></li><li><a href="/vBook/pages/6b188d/" class="sidebar-link">Service Worker</a></li><li><a href="/vBook/pages/02ac9f/" class="sidebar-link">Web Worker</a></li><li><a href="/vBook/pages/008f4c/" class="sidebar-link">Iframe框架及优缺点</a></li><li><a href="/vBook/pages/a389c7/" class="sidebar-link">常见的兼容性问题</a></li><li><a href="/vBook/pages/db741a/" class="sidebar-link">300ms点击延迟</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>css</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vBook/pages/24112d/" class="sidebar-link">01.自定义核心功能</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>js</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vBook/pages/1231e4/" class="sidebar-link">this 全面解析</a></li><li><a href="/vBook/pages/9b0291/" class="sidebar-link">按值传递</a></li><li><a href="/vBook/pages/ec77b1/" class="sidebar-link">作用域闭包</a></li><li><a href="/vBook/pages/64ade6/" class="sidebar-link">深浅拷贝原理</a></li><li><a href="/vBook/pages/452a32/" class="sidebar-link">事件循环</a></li><li><a href="/vBook/pages/00b430/" class="sidebar-link">DOM事件</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>git</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vBook/pages/a23366/" class="sidebar-link">基础</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>web安全</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vBook/pages/15d0ea/" class="sidebar-link">前端安全</a></li><li><a href="/vBook/pages/eaa869/" class="sidebar-link">前端安全在工作中的实践</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>性能优化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vBook/pages/9d6135/" class="sidebar-link">PWA</a></li><li><a href="/vBook/pages/bb869d/" class="sidebar-link">性能优化在工作中的实践</a></li></ul></section></li><li><a href="/vBook/pages/3a142b/" class="sidebar-link">Web Component</a></li><li><a href="/vBook/pages/6f00c4/" class="sidebar-link">npm</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>浏览器</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vBook/pages/672952/" class="sidebar-link">垃圾回收机制</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>工程化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vBook/pages/a103e8/" aria-current="page" class="active sidebar-link">webpack</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/vBook/pages/a103e8/#基础" class="sidebar-link">基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/vBook/pages/a103e8/#安装和配置" class="sidebar-link">安装和配置</a></li><li class="sidebar-sub-header level3"><a href="/vBook/pages/a103e8/#模式" class="sidebar-link">模式</a></li><li class="sidebar-sub-header level3"><a href="/vBook/pages/a103e8/#入口" class="sidebar-link">入口</a></li><li class="sidebar-sub-header level3"><a href="/vBook/pages/a103e8/#出口" class="sidebar-link">出口</a></li><li class="sidebar-sub-header level3"><a href="/vBook/pages/a103e8/#loader" class="sidebar-link">Loader</a></li><li class="sidebar-sub-header level3"><a href="/vBook/pages/a103e8/#plugin" class="sidebar-link">Plugin</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/vBook/pages/a103e8/#进阶" class="sidebar-link">进阶</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/vBook/pages/a103e8/#devserver" class="sidebar-link">devServer</a></li><li class="sidebar-sub-header level3"><a href="/vBook/pages/a103e8/#hmr" class="sidebar-link">HMR</a></li><li class="sidebar-sub-header level4"><a href="/vBook/pages/a103e8/#工作原理" class="sidebar-link">工作原理</a></li><li class="sidebar-sub-header level3"><a href="/vBook/pages/a103e8/#优化" class="sidebar-link">优化</a></li><li class="sidebar-sub-header level4"><a href="/vBook/pages/a103e8/#打包体积" class="sidebar-link">打包体积</a></li><li class="sidebar-sub-header level4"><a href="/vBook/pages/a103e8/#构建速度" class="sidebar-link">构建速度</a></li><li class="sidebar-sub-header level3"><a href="/vBook/pages/a103e8/#手写" class="sidebar-link">手写</a></li></ul></li></ul></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/vBook/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>博客</span></li><li data-v-06225672><span data-v-06225672>工程化</span></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="javascript:;" data-v-06225672>Hevin</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-07-09</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">webpack<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="webpack"><a href="#webpack" class="header-anchor">#</a> Webpack</h1> <p>Webpack 是一个模块打包工具，它可以将多个模块打包成一个文件，以便于在浏览器中使用。Webpack 的主要功能包括模块打包、代码转换、文件优化等，它可以帮助开发者更高效地开发和维护应用程序。</p> <h2 id="基础"><a href="#基础" class="header-anchor">#</a> 基础</h2> <p>本节将介绍 Webpack 的基础知识，包括安装和配置、入口和出口、Loader 和 Plugin 等。</p> <h3 id="安装和配置"><a href="#安装和配置" class="header-anchor">#</a> 安装和配置</h3> <p>安装 Webpack 可以使用 npm 命令进行安装，具体命令如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install webpack webpack-cli --save-dev
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>安装完成后，需要进行配置。Webpack 的配置文件是一个 JavaScript 文件，通常命名为 webpack.config.js。配置文件中需要指定入口、出口、Loader 和 Plugin 等信息。</p> <h3 id="模式"><a href="#模式" class="header-anchor">#</a> 模式</h3> <p>webpack分为2种模式 - development、production，分别代表着开发环境和生产环境。通常，我们使用环境变量来判断开发环境。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// 设置脚本变量
&quot;build&quot;: &quot;cross-env NODE_ENV=production vue-cli-service build&quot;
// env文件
.env
NODE_ENV=production
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="入口"><a href="#入口" class="header-anchor">#</a> 入口</h3> <p>Webpack 的入口是指应用程序的入口文件，可分为单入口、多入口2种类别，通常入口文件是 JavaScript 代码。入口文件中可以引入其他模块，Webpack 会根据入口文件和引入的模块构建依赖关系图，以便于进行打包。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// 单入口
module.exports = {
  entry: './src/main.js',
  output: {
    path: path.resolve(__dirname, 'dist'),
    filename: 'bundle.js'
  }
};
// 多入口
module.exports = {
  entry: {
    app: './src/app.js',
    vendor: './src/vendor.js'
  },
  output: {
    path: path.resolve(__dirname, 'dist'),
    filename: '[name].js'
  }
};
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="出口"><a href="#出口" class="header-anchor">#</a> 出口</h3> <p>出口是指打包后的文件输出路径和文件名。可以通过配置文件中的 output 属性来指定出口信息。例如：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>module.exports = {
  entry: './src/index.js',
  output: {
    path: path.resolve(__dirname, 'dist'),
    filename: 'bundle.js'
  }
};
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="loader"><a href="#loader" class="header-anchor">#</a> Loader</h3> <p>Loader 是用于对模块进行转换的工具，它可以将不同类型的文件转换为 JavaScript 模块。
因为webpack本身只能处理js文件，对于IMG、CSS等类型文件，只能借助于Loader进行处理。
例如，可以使用 babel-loader 将 ES6 代码转换为 ES5 代码，或者使用 css-loader 和 style-loader 将 CSS 文件转换为 JavaScript 模块。
Loader 的使用需要在配置文件中进行配置，例如：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>module.exports = {
  module: {
    rules: [
      {
        test: /\.js$/,
        exclude: /node_modules/,
        use: [
          {
            loader: 'thread-loader',
            options: {
              workerParallelJobs: 50,
              workers: require('os').cpus().length - 1,
              poolTimeout: 2000,
            }
          },
        'babel-loader'
      ]
      },
      {
        test: /\.css$/,
        use: [
          'style-loader',
          'css-loader'
        ]
      }
    ]
  }
};
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="plugin"><a href="#plugin" class="header-anchor">#</a> Plugin</h3> <p>Plugin 是用于扩展 Webpack 功能的工具，它可以在打包过程中（在不同的时间节点）执行一些额外的任务，例如压缩代码、生成 HTML 文件等。
Plugin 的使用需要在配置文件中进行配置，例如：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>const HtmlWebpackPlugin = require('html-webpack-plugin');
module.exports = {
  plugins: [
    new HtmlWebpackPlugin({
      template: './src/index.html'
    })
  ]
};
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>plugin的常见钩子函数如下：</p> <ol><li><code>entryOption</code>：在 Webpack 处理入口配置之前调用，可以修改入口配置。</li> <li><code>afterPlugins</code>：在 Webpack 加载所有插件之后调用，可以访问所有插件实例。</li> <li><code>afterResolvers</code>：在 Webpack 加载所有解析器之后调用，可以访问所有解析器实例。</li> <li><code>environment</code>：在 Webpack 设置环境变量之前调用，可以修改环境变量。</li> <li><code>beforeRun</code>：在 Webpack 开始编译之前调用，可以执行一些准备工作。</li> <li><code>run</code>：在 Webpack 开始编译时调用，可以执行一些初始化工作。</li> <li><code>watchRun</code>：在 Webpack 开始增量编译时调用，可以执行一些增量编译前的准备工作。</li> <li><code>normalModuleFactory</code>：在 Webpack 创建模块工厂之前调用，可以修改模块工厂。</li> <li><code>contextModuleFactory</code>：在 Webpack 创建上下文模块工厂之前调用，可以修改上下文模块工厂。</li> <li><code>beforeCompile</code>：在 Webpack 开始编译之前调用，可以执行一些准备工作。</li> <li><code>compile</code>：在 Webpack 开始编译时调用，可以执行一些初始化工作。</li> <li><code>thisCompilation</code>：在 Webpack 创建新的编译实例时调用，可以访问编译实例。</li> <li><code>compilation</code>：在 Webpack 创建新的编译实例时调用，可以访问编译实例。</li> <li><code>make</code>：在 Webpack 开始构建模块之前调用，可以执行一些准备工作。</li> <li><code>afterCompile</code>：在 Webpack 完成编译之后调用，可以执行一些后续工作。</li> <li><code>emit</code>：在 Webpack 输出资源到输出目录之前调用，可以修改输出资源。</li> <li><code>done</code>：在 Webpack 完成编译和输出之后调用，可以执行一些清理工作。</li></ol> <h2 id="进阶"><a href="#进阶" class="header-anchor">#</a> 进阶</h2> <h3 id="devserver"><a href="#devserver" class="header-anchor">#</a> devServer</h3> <p>Webpack Dev Server 是一个开发服务器，可以快速地进行开发和调试。它提供了多种功能，例如自动刷新、热模块替换、代理等，可以大大提高开发效率和体验。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>module.exports = {
  // ...
  devServer: {
    contentBase: './dist',
    port: 8080,
    hot: true,
    watchContentBase: true,
    watchOptions: {
      poll: true
    }
    proxy: {
      '/api': {
        target: 'http://localhost:3000',
        pathRewrite: { '^/api': '' }
      }
    }
  }
};
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="hmr"><a href="#hmr" class="header-anchor">#</a> HMR</h3> <blockquote><p>参考文献：https://zhuanlan.zhihu.com/p/30669007
Hot Module Replacement（以下简称 HMR）是 webpack 发展至今引入的最令人兴奋的特性之一 。当你对代码进行修改并保存后，webpack 将对代码重新打包，并将新的模块发送到浏览器端，浏览器通过新的模块替换老的模块，在不刷新浏览器的前提下就能够对应用进行更新。</p></blockquote> <h4 id="工作原理"><a href="#工作原理" class="header-anchor">#</a> 工作原理</h4> <p>初识 HMR 的时候觉得其很神奇，一直有一些疑问萦绕在脑海。</p> <ol><li>webpack 可以将不同的模块打包成 bundle 文件或者几个 chunk 文件，但是当我通过 webpack HMR 进行开发的过程中，我并没有在我的 dist 目录中找到 webpack 打包好的文件，它们去哪呢？</li> <li>使用 HMR 的过程中，通过 Chrome 开发者工具我知道浏览器是通过 websocket 和 webpack-dev-server 进行通信的，但是 websocket 的 message 中并没有发现新模块代码。打包后的新模块又是通过什么方式发送到浏览器端的呢？为什么新的模块不通过 websocket 随消息一起发送到浏览器端呢？</li> <li>浏览器拿到最新的模块代码，HMR 又是怎么将老的模块替换成新的模块，在替换的过程中怎样处理模块之间的依赖关系？</li> <li>当模块的热替换过程中，如果替换模块失败，有什么回退机制吗？
带着上面这些疑问，我们寻找 HMR 底层的奥秘。</li> <li>项目在启动时，webpack会启动devServer和clientjs，二者之间以sockjs来进行通信，同时开启watch模式，监听文件是否发生改变。</li> <li>当开发人员改动文件并保存时，webpack（sockjs通信）会主动推送message，clientjs获取信息后解析数据；</li> <li>clientjs根据数据来处理，浏览器以xhr的方式来请求hot-update.json，里面主要包括hash值以及是否change的布尔值，进而浏览器以script（jsonp）的形式获取新文件；</li> <li>HotModulePlugin 将会对新旧模块进行对比，决定是否更新模块，在决定更新模块后，检查模块之间的依赖关系，更新模块的同时更新模块间的依赖引用。</li> <li>最后一步，当 HMR 失败后，回退到 live reload 操作，也就是进行浏览器刷新来获取最新打包代码。
<strong>注</strong>：</li> <li>sockjs通信数据格式</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
  &quot;type&quot;: &quot;sync&quot;,
  &quot;data&quot;: {
    &quot;hash&quot;: &quot;1234abcd&quot;,
    &quot;errors&quot;: [],
    &quot;warnings&quot;: [],
    &quot;modules&quot;: {
      &quot;./src/index.js&quot;: {
        &quot;id&quot;: &quot;./src/index.js&quot;,
        &quot;hash&quot;: &quot;5678efgh&quot;,
        &quot;code&quot;: &quot;console.log('Hello, World!');&quot;,
        &quot;map&quot;: null
      }
    }
  }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>req: d2c6d3949ff77eb35270.hot-update.json
res: {&quot;h&quot;:&quot;019ecdc516fa71841db1&quot;,&quot;c&quot;:{&quot;32&quot;:true}}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>![image-20230619160816359](/Users/hedong/Library/Application Support/typora-user-images/image-20230619160816359.png)
![image-20230619154529002](/Users/hedong/Library/Application Support/typora-user-images/image-20230619154529002.png)</p> <h3 id="优化"><a href="#优化" class="header-anchor">#</a> 优化</h3> <p>Webpack是以js为基础的一个打包工具，js作为一门单进程语言在处理大型应用程序时，可能会遇到性能问题。本节将主要介绍 Webpack优化方面的知识，主要包括构建速度以及打包体积。</p> <h4 id="打包体积"><a href="#打包体积" class="header-anchor">#</a> 打包体积</h4> <p>Webpack 的打包体积受多个因素影响，包括代码分离、压缩等。下面介绍一些优化打包体积的方法。</p> <ol><li>Tree Shaking
Tree Shaking 是指通过静态分析代码，删除未使用的代码，从而减小打包体积。可以通过配置 optimization 属性中的 usedExports 和 sideEffects 属性来启用 Tree Shaking。</li> <li>Scope Hoisting
Scope Hoisting 是指将模块中的代码合并到一个函数中，从而减小打包体积。可以通过配置 optimization 属性中的 concatenateModules 属性来启用 Scope Hoisting。</li> <li>代码分离
代码分离是指将应用程序中的代码分成多个块，以便于更快地加载和执行。可以通过入口起点、SplitChunksPlugin 插件和动态导入等方式来进行代码分离。</li> <li>压缩代码
压缩代码可以减小打包体积。Webpack 提供了多种方式来进行代码压缩，包括 UglifyJSPlugin、TerserPlugin、gzip压缩等。</li></ol> <blockquote><p>UglifyJS： Webpack 中用于压缩和混淆<strong>JavaScript</strong>代码的工具，可以将 JavaScript 代码压缩成更小的体积，以便减少文件的传输时间和提高页面性能。UglifyJS 可以删除代码中的空格、注释、未使用的变量和函数、重复的代码等，从而减少文件的体积。UglifyJS 还可以将变量名和函数名替换为更短的名称，以减少文件的体积和提高代码的混淆程度。</p> <p>TerserPlugin： Webpack 中用于压缩和混淆 JavaScript 代码的插件，是 UglifyJS 的替代品，可以将 JavaScript 代码压缩成更小的体积，以便减少文件的传输时间和提高页面性能。</p> <p>Gzip：一种<strong>文件压缩</strong>技术，可以将文件压缩成更小的体积，以便减少文件的传输时间和提高页面性能。Gzip 可以将文本文件（例如 HTML、CSS、JavaScript 等）压缩成更小的体积，从而减少文件的传输时间和提高页面的加载速度和性能。</p></blockquote> <h4 id="构建速度"><a href="#构建速度" class="header-anchor">#</a> 构建速度</h4> <p>Webpack 的构建速度受多个因素影响，包括文件数量、依赖关系、插件等。下面介绍一些优化构建速度的方法。</p> <ol><li>缓存
Webpack 提供了多种方式来进行缓存，包括输出文件名、Hash、ChunkHash 和 contentHash 等。使用缓存可以避免重复构建已经构建过的文件，从而提高构建速度。</li> <li>多进程
Webpack 4 中引入了多进程构建和多线程构建的功能，可以通过配置 parallel 属性来启用。使用多进程或多线程构建可以利用多核 CPU 的优势，提高构建速度。</li> <li>减少文件数量
减少文件数量可以减少构建时间。可以通过合并文件、删除无用文件等方式来减少文件数量。</li> <li>使用 DllPlugin
DllPlugin 是用于分离第三方库的插件，可以将第三方库打包成单独的文件，从而减少构建时间。使用 DllPlugin 需要先将第三方库打包成单独的文件，然后在主配置文件中引入。</li></ol> <h3 id="手写"><a href="#手写" class="header-anchor">#</a> 手写</h3> <ol><li>手写webpack plugin</li></ol> <blockquote><p>emit：在 Webpack 输出资源到输出目录之前调用，可以修改输出资源。
功能：向index.html中功能位置自动插入script、link、dns-prefetch等功能；</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>const orderMap = {
  dns: 'titleBefore',
  titleBefore: 'titleBefore',
  css: 'titleAfter',
  link: 'titleAfter',
  titleAfter: 'titleAfter',
  idBefore: 'idBefore',
  js: 'bodyLast',
  javascript: 'bodyLast'
}
class InsertLinkPlugin {
  constructor(options) {
    this.options = options ? (Array.isArray(options) ? options : [options]) : [];
  }
  apply(compiler) {
    compiler.hooks.emit.tapAsync(&quot;InsertLinkPlugin&quot;, (compilation, callback) =&gt; {
      let htmlSource = compilation.assets[&quot;index.html&quot;].source();
      this.options.forEach(option =&gt; {
        const placeLocation = orderMap[option.type] || 'bodyLast';
        console.log('placeLocation', placeLocation);
        if (placeLocation === 'titleBefore') {
          const linkTag = `&lt;link href=&quot;${option.url}&quot; rel=&quot;${option.rel}&quot; /&gt;`;
          htmlSource = htmlSource.replace(&quot;&lt;title&gt;&quot;, `${linkTag}&lt;title&gt;`);
        } else if (placeLocation === 'titleAfter') {
          const linkTag = `&lt;link href=&quot;${option.url}&quot; rel=&quot;${option.rel}&quot; /&gt;`;
          htmlSource = htmlSource.replace(&quot;&lt;/title&gt;&quot;, `&lt;/title&gt;${linkTag}`);
        } else if (placeLocation === 'bodyLast') {
          if (option.defer) {
            const linkTag = `&lt;script type='text/javascript' src=&quot;${option.url}&quot; defer &gt;&lt;/script&gt;`;
            htmlSource = htmlSource.replace(&quot;&lt;/body&gt;&quot;, `${linkTag}&lt;/body&gt;`);
          } else if (option.async) {
            const linkTag = `&lt;script type='text/javascript' src=&quot;${option.url}&quot; async &gt;&lt;/script&gt;`;
            htmlSource = htmlSource.replace(&quot;&lt;/body&gt;&quot;, `${linkTag}&lt;/body&gt;`);
          } else {
            const linkTag = `&lt;script type='text/javascript' src=&quot;${option.url}&quot; &gt;&lt;/script&gt;`;
            htmlSource = htmlSource.replace(&quot;&lt;/body&gt;&quot;, `${linkTag}&lt;/body&gt;`);
          }
        } else if (placeLocation === 'idBefore') {
          const linkTag = `&lt;script type='text/javascript' src=&quot;${option.url}&quot; &gt;&lt;/script&gt;`;
          htmlSource = htmlSource.replace(&quot;&lt;body&gt;&quot;, `&lt;body&gt;${linkTag}`);
        }
      });
      // 将处理后的 index.html 重新赋给 compilation.assets 的 &quot;index.html&quot; 属性
      compilation.assets[&quot;index.html&quot;] = {
        source: () =&gt; htmlSource,
        size: () =&gt; htmlSource.length,
      };
      callback(); // 调用回调函数，继续 webpack 编译流程
    })
  }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div></div></div> <!----> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023/7/9 下午3:15:20</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/vBook/pages/672952/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">垃圾回收机制</div></a> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/vBook/pages/672952/" class="prev">垃圾回收机制</a></span> <!----></p></div></div></div> <!----></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2023-2023
    <span>Hevin</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/vBook/assets/js/app.005be619.js" defer></script><script src="/vBook/assets/js/2.60c04350.js" defer></script><script src="/vBook/assets/js/30.671a188d.js" defer></script>
  </body>
</html>
